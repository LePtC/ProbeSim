
更新日志
======

###2016.05.08

本来是为了填之前 [2048 Physics](http://leptc.github.io/2048physics/) 的坑，就在 [w3schools](http://www.w3schools.com/games/default.asp) 学习 Javascript 游戏开发，发现很容易就看懂了。然后觉得 2048 这游戏没什么意思，想起之前一直对 [Duskers](http://search.bilibili.com/all?keyword=duskers) 这个游戏的玩法很感兴趣，于是决定自己开发这个游戏…（← 旧坑不填又开新坑 (╯‵□′)╯︵┻┻）

游戏属于解谜类型，操作方式类似命令行（我大概只能做到组合键…），控制若干个 Probe 探索未知的地图，思考如何探测并杀死敌人，搜集模块使 Probe 升级新功能等等。


###2016.05.10.v1

游戏以 [w3schools 最后这个](http://www.w3schools.com/games/game_movement.asp) 为模版开始开发。首先是 Probe 和墙的碰撞问题，尝试用速度反向来解决，但发现这样的话会有反向按键就能穿墙的 bug…

考虑了正方形的旋转会增加 Probe 的碰撞体积。加入了 relax 机制，在 Probe 蹭墙的过程中角度会被动调正，以后玩家通过较窄的门时的体验会更好。


###2016.05.10.v2

上一版本 relax 角度计算有错，借助 Mathematica 才把公式写对

Probe 终于不会穿墙了，不过似乎获得了蹭墙侧滑的技能…

Probe 走出屏幕可能会找不到了… 这个暂时不打算修复


###2016.05.10.v3

加入地图数组，然后由数组生成墙实体，一次成功

发现 Probe 可通过蹭墙侧滑来穿旁边的墙…


###2016.05.10.v4

Probe 终于不会穿墙也不会侧滑了，强行往墙上开的话会像真实机器人一样在墙附近震动。

往墙角里开的话角能扎进墙里，有一定几率可以从右下墙角隧穿出去，其它墙角则不会，似乎和小于号/小于等于号有关…


###2016.05.10.v5

给不等式都加上了等号的情况，调低速度，还是能隧穿。碰撞体积也不能设太大，不然卡在门中间也会震…

减小 Probe 的尺寸以便能在一格宽的走廊转身，减小后好像就不隧穿了…


###2016.05.10.v6

实现径向递减照明系统


###2016.05.11.v1

加入倾斜因子 1/2(1+cosθ) （求 cos 直接用内积实现），并 3 次方限制照明方位角

###2016.05.11.v2

地图精细度增加，Probe 现最窄能通过两格宽的通道（转身会有震动）

###2016.05.11.v3

实现墙对光线的阻挡，以后加入敌人 AI 后还可以用来判断视野

###2016.05.11.v4

反转了背景和前景，现在墙也需要被照才亮了

去掉了左侧准备给母舰预留的空间，感觉暂时没用

###2016.05.11.v5

通过预判节约了些计算量

墙对光线的阻挡通过类似卷积的原理平滑了

给墙单独补光

###2016.05.11.v6

加入了鼠标和触屏控制（用到了转动变换阵…）

###2016.05.11.v7

发现在移动设备上玩很卡，果然很耗 CPU 么

降低检测密度，这样位于角里的墙块也能被照亮了

以及其它参数微调

###2016.05.11.v8

加入敌人，看见 Probe 会追击，没看见时随机走折线，有撞墙预判

###2016.05.12.v1

（今天有别的事要忙…）加入母舰的墙体，母舰下方空间留作显示 Probe 的数据

发现若右侧的墙不够长，则 Probe 挣扎一会儿后就能穿右下角的墙…

###2016.05.12.v2

加入 Probe 移动音效（光影马赛克也就算了，怎么音效播放出来也一顿一顿的…）

###2016.05.12.v3

加入第一种升级插件：环形照明

对实体加更强的补光

###2016.05.13.v1

母舰加宽

X 形墙测试，发现单层 X 墙会漏光（这个不修复，因为不这样的话就照不亮角里的墙）

Probe 专门能隧穿右方一格下方两格的地形，这个 bug 解决不了我就作彩蛋了…

###2016.05.13.v2

感觉低 fps 更符合这个游戏的风格（解谜类而不是动作类）

（好像移动速度慢了之后就不觉得地图小了呢…）

把地图高度扩大了一倍（需要滚动网页也没关系，这样更有探索感）

###2016.05.13.v3

用两个声音对象交替播放来弥补音效顿歇

###2016.05.13.v4

制成第二种升级插件：生命探测

###2016.05.13.v5

制成第三种升级插件：黑客系统

###2016.05.14.v1

更新了碰撞检测算法，Probe 现在不仅不再能穿墙，在宽度不足的走廊（两格）甚至无法转身

###2016.05.14.v2

加入了 Probe 和 Foe 互怼的碰撞检测

###2016.05.14~15

做 week01 视频

###2016.05.17.v1

生命探测加入范围限制和范围指示

###2016.05.18.v1

环形照明模块自己也能发光，这样以后还可用作母舰内的灯光装饰

静态光源的光影只计算一次然后存起来以节省计算量

多个光源之间似乎有干涉效应 bug …（← 神™干涉）

###2016.05.18.v2

干涉 bug 解决…

###2016.05.18.v3

一个 Probe 现最多可搭载 3 个插件，以体积增大为惩罚（← 然而似乎不足以限制其通过两格宽通道）

###2016.05.18.v4

加入物品栏显示

###2016.05.18.v5

同一插件若叠加可获得更强效果

###2016.05.19.v1

体积增大又会带来新的撞壁 bug，还是先去掉这个设定吧

###2016.05.19.v2

地图减小为 800*600

已经装满了的 Probe 将穿过插件方块（而不是视为墙）

###2016.05.19.v3

按数字键 123 可使用相应物品栏，静态插件的效果是扔到地上

###2016.05.20.v1

扔到地上不再有卡顿

###2016.05.20.vf

用查表代替对 1/r 和 1-r/max 的计算，似乎并没有降低 CPU 占用，而且由于取整还造成了光强的闪烁，此版回滚

###2016.05.20.v2

子弹和生命值系统上线！

子弹的速度既不能太好躲也不能太难躲

###2016.05.20.v3

子弹出射角度加入随机涨落，避免玩家按固定套路走位就能躲过子弹

###2016.05.20.v4

敌人追击角度加入随机涨落，避免挤到一堆

###2016.05.20.v5

加入新敌人 Hamper，追击没有涨落，专门妨碍 Probe 的

###2016.05.20.v6

加入 shoot 音效（javascript 的音效播放真无力吐槽，估计以后不会要音效了…）

###2016.05.20.v7

加入 Creeper 爆炸伤害及音效

###2016.05.21.v1

鼠标由移动控制变为单击控制，通过单击物品栏可放下物品

###2016.05.21.v2

修复鼠标哪也没点 bug，新地图，代码更简洁

###2016.05.21.v3

做出护盾 mod（做好模拟器后，要做一个新的 mod 特别简单）

###2016.05.23.v1

Probe Health<0 后重生在出生点，物品掉落在死亡地点，物品栏增加到 5 个

###2016.06.02.v0.funbug

敌人现会被子弹打死了（一开始有个会被自己的子弹打死的 bug 2333）

Shooter 死亡掉落子弹插件，Creeper 死亡掉落陷阱插件

###2016.06.02.v0.fix

插件现不必放在整数坐标，降低了重叠的概率

###2016.06.02.v1

让子弹多飞一段避免打死自己 2333

###2016.06.02.v2

Probe 重生时插件随机散落避免重叠

按 F1~F5 开火（不知道鼠标要怎么控制呢…）

测试阶段暂时设定为无限弹药

仍然有一定几率开枪会打死自己，Probe 和 Shooter 均有此 bug

###2016.06.03.v1

上一 bug 源于设置子弹的 offset 时智商下线导致不同方向偏离圆心…

有了开火后突然觉得加入动作元素也挺过瘾的…

Probe 的操作加入侧滑，PgUp PgDn 控制转向

同时还支持 JKLI 控制前后左右，UO 控制转向

鼠标点过后就不能回到键盘操作了，所以暂时禁用掉鼠标和触控操作

###2016.06.04.v1

持有治疗插件时会回血，~~另外还可选择使用掉它回满血~~（有下一条之后就没人会用这个功能了吧？）

Probe 死亡时若带有治疗插件则自动消耗掉

###2016.06.04.v2

上一条设定改成 +99 而非 =99，以防玩家利用残血去扛爆炸

###2016.06.04.v3

发现无限子弹还可以演示多普勒效应 [笑cry]

Probe 的默认速度和角速度增加，敌人的速度也相应增加

###2016.06.04.v4

子弹有限，且有 CD 时间

Creeper 的爆炸伤害按距离 r<10 向内递增

Creeper 加入点燃音效，r<5 点燃，15 帧后爆炸

###2016.06.10.v1

取消字母键控制方向（因为将来要控制门）（← 程序狸追着砍需求狸…），恢复鼠标触控，支持同时用

用有限视野来降低功耗（窝真机智），ctrl+方向键 移动视角

###2016.06.10.v2

目前只有一个 Probe，暂时设为自动将 Probe 置于视野中心，ctrl 暂时不用了吧

javascript 绘制分数坐标的墙时会有插值导致画面出现格子，用 Math.floor 解决

###2016.06.10.v3

不用计算视野外的墙

光照和生命探测的范围缩小

###2016.06.10.v4

不要用侧滑，用长按角速度加速的方式，避免无法微操

我想到一个绝妙的算法，将一块地板切成九块来显示，替代卷积算法，这样既让光影更精细了又降低了计算量

de 了 N 次 bug 后终于做出来了，平地上光影效果非常细腻，墙影边缘效果比较奇特

###2016.06.10.v5

Hamper 有接触伤害（待加音效）

###2016.06.11.v1

触控面板上线

目测我的电脑上游戏只有 10 fps :joy:

###2016.06.11.v2

将 setInterval 换成 requestAnimationFrame 说是效率更高，然而我并没有感觉到 fps 提高

Chrome 的 fps 比 Firefox 高，感觉可以流畅玩（所以是 Firefox 的问题咯？）

###2016.06.11.v3

进一步节约计算量，原来耗计算量的地方是在算每块砖和 Probe 的距离上，现在 Firefox 上也能较流畅地玩了

###2016.06.12.v1

Modlit 的光影沿用旧版以给墙补光

###2016.06.12.v2

用空格 + 12345 代替 F1~F5

无法同时按下空格+前进+左键, 其它的都没问题, 谜

发现 fps 在 IE 上才是最高的… 惊了

###2016.06.12.v3

改成按一下空格切换探索/战斗模式

物品栏加入数字提示


###Bug

敌人在追 Probe 时能穿一层厚的斜墙…

（不知道算不算 bug）多个插件可能扔到同一块地上

3 个 Hamper 居然能把 Probe 挤到穿墙…

Creeper 自爆的话就不要掉落 Mod

触控下点哪都 drop mod

敌人的视野中有友军就不开枪…（为啥我觉得不修复这个会更好玩…）

stage 的右方和上方可见黑边



###TODO

触控面板加入 fire 按钮

显示信息、主菜单、小地图

显示剧情对话历史，兼作暂停功能

插件可堆叠？（越来越像 minecraft 了…）

触控角速度设定为直接跟随？（开始变得像 slither 了…）

陷阱插件的用法：丢在整数格地板上（Probe 死亡掉落怎么办… 还是用 F 键吧），若陷阱被光照则敌人不敢越过陷阱，若无光照则敌人踩中陷阱被杀死，插件被消耗掉

激光瞄准器，可以和子弹类似地实现，区别是遇墙会反射（于是我想进一步精细化马赛克，然而游戏现在在我的笔记本电脑上都卡成 PPT 了…）

攻下机枪塔后可获得激光器

靶机：吸引敌人的火力，直到耐久耗尽

光源插件可被发射出去作为探路球

某一类升级插件吃满后解锁特殊技能…

Creeper 引燃闪光动画

敌人互相之间有碰撞

敌人丢失 Probe 视野后仍锁定一段时间追击方向

死掉的敌人仍有弱碰撞体积

门，蓝色的门为母舰门，可拆下来作为战术道具

绿色门需压力或感光或黑客系统才能控制

优化光影算法，然后再加入第二个 Probe



---

（↑↑ 开发的速度追不上开脑洞的速度…程序猿紧缺中…）
