
更新日志
======

###2016.05.08

本来是为了填之前 [2048 Physics](http://leptc.github.io/2048physics/) 的坑，就在 [w3schools](http://www.w3schools.com/games/default.asp) 学习 Javascript 游戏开发，发现很容易就看懂了。然后觉得 2048 这游戏没什么意思，想起之前一直对 [Duskers](http://search.bilibili.com/all?keyword=duskers) 这个游戏的玩法很感兴趣，于是决定自己开发这个游戏…（← 旧坑不填又开新坑 (╯‵□′)╯︵┻┻）

游戏属于解谜类型，操作方式类似命令行（我大概只能做到组合键…），控制若干个 Probe 探索未知的地图，思考如何探测并杀死敌人，搜集模块使 Probe 升级新功能等等。


###2016.05.10.v1

游戏以 [w3schools 最后这个](http://www.w3schools.com/games/game_movement.asp) 为模版开始开发。首先是 Probe 和墙的碰撞问题，尝试用速度反向来解决，但发现这样的话会有反向按键就能穿墙的 bug…

考虑了正方形的旋转会增加 Probe 的碰撞体积。加入了 relax 机制，在 Probe 蹭墙的过程中角度会被动调正，以后玩家通过较窄的门时的体验会更好。


###2016.05.10.v2

上一版本 relax 角度计算有错，借助 Mathematica 才把公式写对

Probe 终于不会穿墙了，不过似乎获得了蹭墙侧滑的技能…

Probe 走出屏幕可能会找不到了… 这个暂时不打算修复


###2016.05.10.v3

加入地图数组，然后由数组生成墙实体，一次成功

发现 Probe 可通过蹭墙侧滑来穿旁边的墙…


###2016.05.10.v4

Probe 终于不会穿墙也不会侧滑了，强行往墙上开的话会像真实机器人一样在墙附近震动。

往墙角里开的话角能扎进墙里，有一定几率可以从右下墙角隧穿出去，其它墙角则不会，似乎和小于号/小于等于号有关…


###2016.05.10.v5

给不等式都加上了等号的情况，调低速度，还是能隧穿。碰撞体积也不能设太大，不然卡在门中间也会震…

减小 Probe 的尺寸以便能在一格宽的走廊转身，减小后好像就不隧穿了…


###2016.05.10.v6

实现径向递减照明系统


###2016.05.11.v1

加入倾斜因子 1/2(1+cosθ) （求 cos 直接用内积实现），并 3 次方限制照明方位角

###2016.05.11.v2

地图精细度增加，Probe 现最窄能通过两格宽的通道（转身会有震动）

###2016.05.11.v3

实现墙对光线的阻挡，以后加入敌人 AI 后还可以用来判断视野

###2016.05.11.v4

反转了背景和前景，现在墙也需要被照才亮了

去掉了左侧准备给母舰预留的空间，感觉暂时没用

###2016.05.11.v5

通过预判节约了些计算量

墙对光线的阻挡通过类似卷积的原理平滑了

给墙单独补光

###2016.05.11.v6

加入了鼠标和触屏控制（用到了转动变换阵…）

###2016.05.11.v7

发现在移动设备上玩很卡，果然很耗 CPU 么

降低检测密度，这样位于角里的墙块也能被照亮了

以及其它参数微调

###2016.05.11.v8

加入敌人，看见 Probe 会追击，没看见时随机走折线，有撞墙预判

###2016.05.12.v1

（今天有别的事要忙…）加入母舰的墙体，母舰下方空间留作显示 Probe 的数据

发现若右侧的墙不够长，则 Probe 挣扎一会儿后就能穿右下角的墙…

###2016.05.12.v2

加入 Probe 移动音效（光影马赛克也就算了，怎么音效播放出来也一顿一顿的…）

###2016.05.12.v3

加入第一种升级插件：环形照明

对实体加更强的补光

###2016.05.13.v1

母舰加宽

X 形墙测试，发现单层 X 墙会漏光（这个不修复，因为不这样的话就照不亮角里的墙）

Probe 专门能隧穿右方一格下方两格的地形，这个 bug 解决不了我就作彩蛋了…

###2016.05.13.v2

感觉低 fps 更符合这个游戏的风格（解谜类而不是动作类）

（好像移动速度慢了之后就不觉得地图小了呢…）

把地图高度扩大了一倍（需要滚动网页也没关系，这样更有探索感）

###2016.05.13.v3

用两个声音对象交替播放来弥补音效顿歇

###2016.05.13.v4

制成第二种升级插件：生命探测

###2016.05.13.v5

制成第三种升级插件：黑客系统

###2016.05.14.v1

更新了碰撞检测算法，Probe 现在不仅不再能穿墙，在宽度不足的走廊（两格）甚至无法转身

###2016.05.14.v2

加入了 Probe 和 Foe 互怼的碰撞检测

###2016.05.14~15

做 week01 视频

###2016.05.17.v1

生命探测加入范围限制和范围指示

###2016.05.18.v1

环形照明模块自己也能发光，这样以后还可用作母舰内的灯光装饰

静态光源的光影只计算一次然后存起来以节省计算量

多个光源之间似乎有干涉效应 bug …（← 神™干涉）

###2016.05.18.v2

干涉 bug 解决…

###2016.05.18.v3

一个 Probe 现最多可搭载 3 个插件，以体积增大为惩罚（← 然而似乎不足以限制其通过两格宽通道）

###2016.05.18.v4

加入物品栏显示

###2016.05.18.v5

同一插件若叠加可获得更强效果

###2016.05.19.v1

体积增大又会带来新的撞壁 bug，还是先去掉这个设定吧

###2016.05.19.v2

地图减小为 800*600

已经装满了的 Probe 将穿过插件方块（而不是视为墙）

###2016.05.19.v3

按数字键 123 可使用相应物品栏，静态插件的效果是扔到地上

###2016.05.20.v1

扔到地上不再有卡顿

###2016.05.20.vf

用查表代替对 1/r 和 1-r/max 的计算，似乎并没有降低 CPU 占用，而且由于取整还造成了光强的闪烁，此版回滚

###2016.05.20.v2

子弹和生命值系统上线！

子弹的速度既不能太好躲也不能太难躲

###2016.05.20.v3

子弹出射角度加入随机涨落，避免玩家按固定套路走位就能躲过子弹

###2016.05.20.v4

敌人追击角度加入随机涨落，避免挤到一堆

###2016.05.20.v5

加入新敌人 Hamper，追击没有涨落，专门妨碍 Probe 的

###2016.05.20.v6

加入 shoot 音效（javascript 的音效播放真无力吐槽，估计以后不会要音效了…）

###2016.05.20.v7

加入 Creeper 爆炸伤害及音效


###Bug

敌人在追 Probe 时能穿一层厚的斜墙…

（不知道算不算 bug）两个插件可扔到同一块地上

###TODO

按数字键 123 ，动态插件的效果是 fire（一次性）

Shooter 死亡掉落子弹插件，Creeper 死亡掉落陷阱插件

敌人丢失 Probe 视野后仍锁定一段时间追击方向

门，蓝色门由母舰控制，绿色门需黑客系统才能控制，以及键盘党鼠标党触控党各自的控制方式

优化光影算法，然后再加入第二个 Probe



